<!DOCTYPE html>

<html lang="en">
	<head>
		<meta charset="utf-8" />
	</head>
	<style> 
	.square{
		width: 50px;
		height: 50px;
	}
	.unclicked{
	width: 50px;
	height: 50px;
	background: gray;
	}
	.clicked{
	width: 50px;
	height: 50px;
	background: white;
	}
	.highlight {
		background-color:red;
	}
	</style>
	<script src="jquery/jquery-1.11.1.min.js"></script> 
	<script type="text/javascript">





	$(document).ready(function(){  


		var n = 8
		//create grid 
		var id_index=[]
		for (i=0; i<n; i++){
			for (j=0; j<n; j++){
				id_index.push([i,j])
			}
		}
		console.log(id_index)
		for (i=0; i<n; i++){
			// var y_id = (parseInt(i))
			// y_array.push(y_id)
			 
			$(".grid").append("<tr class='gridrow' " + '\"'+i+'\"'+"></tr>")
		} 

		for (i=0;i<n;i++){
				//var x_id = "x:"+(parseInt(i))
				//link id to variable
				var square_coords = id_index.shift()

				$(".gridrow").append("<td class='unclicked' 'column' " + '\"'+i+'\"'+"></td>")
		} 
		var gen_rows = function(x){ 
			var row = []
			for (i=0; i<x; i++){
				var o = {}
				o.is_visible = "false";
				o.category = "empty"; 
				o.number = 0;
				o.x_coord=i;
				o.y_coord=0;
				row.push(o)
			} 
			return row
		} 
		//create array for board
		//works 
		var init_board = function(x){
			var container = [];
			var row = gen_rows()
			for (var i=0; i<x; i++){
				var row = gen_rows(n)
				container.push(row)  
			}
			return container
				} 
	//board is created
		var seed_bomb= function(x){
			var seed_bomb_index = Math.floor(Math.random() * 7)
			return seed_bomb_index
		}
		var gen_bomb_coordinates=function(){ 
		 		var x = seed_bomb(n);
		 		var y = seed_bomb(n); 
				return [x, y]
		}
		console.log(gen_bomb_coordinates())
		var get_bomb_coordinates = function(){
			var bomb_coordinates = [];
			var num_bombs = 3
			for(var i=0; i<num_bombs; i++){
				bomb_coordinates.push(gen_bomb_coordinates())
				console.log(bomb_coordinates[i])
			}  
			return bomb_coordinates
		}


		var gen_board_array = function(){
			var board = init_board(n)
			console.log(board)
			var bomb_coordinates = get_bomb_coordinates() 
			console.log(bomb_coordinates)
			var l = bomb_coordinates.length 			
			for (i=0; i<l; i++){
				var current = bomb_coordinates.pop() 
				console.log(current) 
				var x = current[0];  
				var y = current[1];  
				board[x][y]["category"] = "bomb" 
				console.log(board[x][y], "bomb?")
					if(x > 0 && y<n && board[x-1][y+1]["category"]!="bomb"){
						board[x-1][y+1]["number"]++
						board[x-1][y+1]["category"]="number"
						console.log(board[x-1][y+1])
					}
					if (x>0 && y>0 && board[x-1][y-1]["category"]!="bomb"){
						board[x-1][y-1]["number"]++
						board[x-1][y-1]["category"]="number"
						console.log(board[x-1][y-1])
					}
					if (y>0 && x<n && board[x+1][y-1]["category"]!="bomb"){
						board[x+1][y-1]["number"]++
						board[x+1][y-1]["category"]="number"
						console.log(board[x+1][y-1])
					}
					if (x<n && y<n && board[x+1][y+1]["category"]!="bomb"){
						board[x+1][y+1]["number"]++
						board[x+1][y+1]["category"]="number"
						console.log(board[x+1][y+1])
					}
					if (x<n && board[x+1][y]["category"]!="bomb"){
						board[x+1][y]["number"]++
						board[x+1][y]["category"]="number"
						console.log(board[x+1][y])
					}
					if (y<n && board[x][y+1]["category"]!="bomb"){
						board[x][y+1]["number"]++
						board[x][y+1]["category"]="number"
						console.log(board[x][y+1])
					}
					if (y>0 && board[x][y-1]["category"]!="bomb"){
						board[x][y-1]["number"]++
						board[x][y-1]["category"]="number"
						console.log(board[x][y-1])
					}
					if (x>0 && board[x-1][y]["category"]!="bomb"){
						board[x-1][y]["number"]++
						board[x-1][y]["category"]="number"
						console.log(board[x-1][y])	
					} 
				}
			return board
		}
		var get_neighbors = function(x, y) {
			console.log(x+","+y)
			var surrounding_squares = []
					if(x > 0 && y<n){
						console.log((x-1),(y+1))
						surrounding_squares.push([(x-1),(y+1)])
						console.log(surrounding_squares)
					}
					if (x>0 && y>0){ 
						surrounding_squares.push([(x-1),(y+1)])
						console.log(surrounding_squares)
					}
					if (y>0 && x<n){ 
						surrounding_squares.push([(x+1),(y-1)])
						console.log(surrounding_squares)
					}
					if (x<n && y<n){ 
						surrounding_squares.push([(x+1),(y+1)])
						console.log(surrounding_squares)
					}
					if (x<n){ 
						surrounding_squares.push([(x-1),(y)])
						console.log(surrounding_squares)
					}
					if (y<n){ 
						surrounding_squares.push([x,(y+1)])
						console.log(surrounding_squares)
					}
					if (y>0){ 
						surrounding_squares.push([x,(y+1)])
						console.log(surrounding_squares)
					}
					if (x>0){ 	
						surrounding_squares.push([(x-1),y])
						console.log(surrounding_squares)
					}  
					console.log(surrounding_squares)
					return surrounding_squares
			}
		// 
		var not_bombs = function(x,y){
			var neighbors = get_neighbors(x,y)
			for (i=0; i<neighbors.length; i++){
				if(board[i[0]][i[1]].category!="bomb"){
					board[i[0]][i[1]].is_visible=true 
				}
				if(board[i[0]][i[1]].category=="empty"){
					get_neighbors(i[0],i[1])
				}
			}
		}

		var array_of_boards = []
  		if(array_of_boards.length<1){
  			array_of_boards.push(gen_board_array())
  			console.log("pushed array")
  		}
		var board = array_of_boards[0]

		// event listener to get coordinates
  		$( "*", document.body ).click(function( event ) {
		event.stopPropagation();
		var offset = $( this ).position(); 
		$( "#result" ).text( this.tagName +
		    " coords ( " + offset.left + ", " + offset.top + " )" ); 

		var x = offset.left;
			  if (x===10){
			  	board_x = 0
			  }
			  if (x>10){
			  	board_x = (x-10)/54
			  }
		var y = offset.top
			  if(y===52){
			  	var board_y =0
			  }
			  else{
			  	var board_y = (y-52)/54
			  } 
		
		  if(board[board_x][board_y]["category"]=="bomb"){
		  	console.log(board[board_x][board_y])
		  	$(this).text("X");
		  	$(this).toggleClass("") 
		  	console.log($(this).id())
		  }
		  if(board[board_x][board_y]["category"]=="empty"){  
		  	//creates array of neighboring square indexes with category of empty
		  	var neighbors = get_neighbors(board_x,board_y)
		  	console.log(neighbors)
		  	//console log shows array of arrays with indexes. so far so good...
		  	//array index to offset position 
		  	//below is where the trouble is
		  	for(i=0; i<neighbors.length; i++){
		  		console.log(neighbors[i])
		  		var grid_x_position = neighbors[i][0];
		  		console.log(grid_x_position)
		  		var grid_y_position = neighbors[i][1]; 
		  		console.log("gridrow"+" "+grid_y_position+" + column "+grid_x_position)
		  		$("gridrow"+" "+grid_y_position+" + column"+grid_x_position).text("this")
		  		// row id = grid_y_position .child column id = grid_x_position . text = board[board_x][board_y]["category"]
		  	}
		  }
		  if(board[board_x][board_y]["number"]>0){
		  	$(this).text(board[board_x][board_y]["number"]);
		  	$(this).css("color","red");
		  }
		  
		});
  		// map coordinates to board arrays
  		//show text if board
  		 


	}); 
	</script>
	<body>
	<p id="result">Click a square</p>
	<div id="board">
                <table class="grid">
                </table>
     </div>
	
	</body>
