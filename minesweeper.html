<!DOCTYPE html>

<html lang="en">
	<head>
		<meta charset="utf-8" />
	</head>
	<style> 
	.square{
		width: 50px;
		height: 50px;
	}
	.unclicked{
	width: 50px;
	height: 50px;
	background: gray;
	}
	.clicked{
	width: 50px;
	height: 50px;
	background: white;
	}
	.highlight {
		background-color:red;
	}
	</style>
	<script src="jquery/jquery-1.11.1.min.js"></script> 
	<script type="text/javascript">
$(document).ready(function(){  
		var n = 8
		//create grid 
		var id_index=[]
		for (i=0; i<n; i++){
			for (j=0; j<n; j++){
				id_index.push([i,j])
			}
		}
		console.log(id_index)
		for (i=0; i<n; i++){
			// var y_id = (parseInt(i))
			// y_array.push(y_id)
			 
			$(".grid").append("<tr class='gridrow' id=row"+(i+1)+"></tr>")
		} 

		for (i=0;i<n;i++){
				//var x_id = "x:"+(parseInt(i))
				//link id to variable
				var square_coords = id_index.shift()

				$(".gridrow").append("<td class='unclicked' id=column"+(i+1)+"></td>")
		} 
		var gen_rows = function(x){ 
			var row = []
			for (i=0; i<x; i++){
				var o = {}
				o.is_visible = "false";
				o.category = "empty"; 
				o.number = 0;
				o.x_coord=i;
				o.y_coord=0;
				row.push(o)
			} 
			return row
		}  
		var init_board = function(x){
			var container = [];
			var row = gen_rows()
			for (var i=0; i<x; i++){
				var row = gen_rows(n)
				container.push(row)  
			}
			return container
				}  
		var seed_bomb= function(){
			var seed_bomb_index = Math.floor(Math.random() * 7)
			return seed_bomb_index
		}
		var gen_bomb_coordinates=function(){ 
		 		var x = seed_bomb();
		 		var y = seed_bomb();  
		 		return [x,y]
		} 
		//below function: check to make sure that no two bomb coordinates
		var get_bomb_coordinates = function(){
			var bomb_coordinates = [];
			var num_bombs = 3
			while (bomb_coordinates.length<=num_bombs){
				var new_bomb = gen_bomb_coordinates()
    			if (jQuery.inArray(new_bomb, bomb_coordinates) == -1){
					bomb_coordinates.push(new_bomb) 
					console.log("boom"+bomb_coordinates)
				}
			}  
				return bomb_coordinates
		}
		var gen_board_array = function(){
			var board = init_board(n) 
			var bomb_coordinates = get_bomb_coordinates()  
			var l = bomb_coordinates.length 			
			for (i=0; i<l; i++){
				var current = bomb_coordinates.pop()  
				var x = current[0];  
				var y = current[1];  
				board[x][y]["category"] = "bomb" 
					if(x > 0 && y<n && board[x-1][y+1]["category"]!="bomb"){
						board[x-1][y+1]["number"]++
						board[x-1][y+1]["category"]="number"
					}
					if (x>0 && y>0 && board[x-1][y-1]["category"]!="bomb"){
						board[x-1][y-1]["number"]++
						board[x-1][y-1]["category"]="number" 
					}
					if (y>0 && x<n && board[x+1][y-1]["category"]!="bomb"){
						board[x+1][y-1]["number"]++
						board[x+1][y-1]["category"]="number" 
					}
					if (x<n && y<n && board[x+1][y+1]["category"]!="bomb"){
						board[x+1][y+1]["number"]++
						board[x+1][y+1]["category"]="number" 
					}
					if (x<n && board[x+1][y]["category"]!="bomb"){
						board[x+1][y]["number"]++
						board[x+1][y]["category"]="number" 
					}
					if (y<n && board[x][y+1]["category"]!="bomb"){
						board[x][y+1]["number"]++
						board[x][y+1]["category"]="number" 
					}
					if (y>0 && board[x][y-1]["category"]!="bomb"){
						board[x][y-1]["number"]++
						board[x][y-1]["category"]="number" 
					}
					if (x>0 && board[x-1][y]["category"]!="bomb"){
						board[x-1][y]["number"]++
						board[x-1][y]["category"]="number" 
					} 
				}
			return board
		}
		var get_neighbors = function(x, y) { 
			var surrounding_squares = []
					if(x > 0 && y<n){ 
						surrounding_squares.push([(x-1),(y+1)]) 
					}
					if (x>0 && y>0){ 
						surrounding_squares.push([(x-1),(y+1)]) 
					}
					if (y>0 && x<n){ 
						surrounding_squares.push([(x+1),(y-1)]) 
					}
					if (x<n && y<n){ 
						surrounding_squares.push([(x+1),(y+1)]) 
					}
					if (x<n){ 
						surrounding_squares.push([(x-1),(y)]) 
					}
					if (y<n){ 
						surrounding_squares.push([x,(y+1)]) 
					}
					if (y>0){ 
						surrounding_squares.push([x,(y+1)]) 
					}
					if (x>0){ 	
						surrounding_squares.push([(x-1),y]) 
					}   
					return surrounding_squares
			}
		// this is not called.
		var not_bombs = function(x,y){
			var neighbors = get_neighbors(x,y)
			console.log("neighbors"+" "+ neighbors)
			for (i=0; i<neighbors.length; i++){
				if(board[i[0]][i[1]].category!="bomb"){
					board[i[0]][i[1]].is_visible=true 
				}
				if(board[i[0]][i[1]].category=="empty"){
					get_neighbors(i[0],i[1])
				}
			}
		}
		var array_of_boards = []
  		if(array_of_boards.length<1){
  			array_of_boards.push(gen_board_array()) 
  		}
		var board = array_of_boards[0]
		// event listener to get coordinates
  		$( "*", document.body ).click(function( event ) {
			event.stopPropagation();
			var offset = $( this ).position(); 
			$( "#result" ).text( this.tagName +
			    " coords ( " + offset.left + ", " + offset.top + " )" ); 

			var x = offset.left;
				  if (x===10){
				  	board_x = 0
				  }
				  if (x>10){
				  	board_x = (x-10)/54
				  }
			var y = offset.top
			if(y===52){
			  	var board_y =0
			}
			else{
			  	var board_y = (y-52)/54
			} 
			
			if(board[board_x][board_y]["category"]=="bomb"){ 
			  $(this).text("X"); 
			}
			//not getting squares to the right, 
			  if(board[board_x][board_y]["category"]=="empty"){   
			  	var neighbors = get_neighbors(board_x,board_y)
			  	for(i=0; i<neighbors.length; i++){
			  		var grid_x_position = neighbors[i][0]; 
			  		var grid_y_position = neighbors[i][1];  
			  		console.log(board[grid_x_position][grid_y_position])
			  		$(this).text(board[grid_x_position][grid_y_position]["category"]+grid_x_position+" "+ grid_y_position)
			  		if (board[grid_x_position][grid_y_position]["category"]=="empty"){
			  			$("#row"+grid_x_position+ "> #column"+grid_y_position).text(board[grid_x_position][grid_y_position]["category"]);
			  		}
			  		if (board[grid_x_position][grid_y_position]["category"]=="number"){
			  			$("#row"+grid_y_position+ "> #column"+grid_x_position).text(board[grid_x_position][grid_y_position]["number"]).css("color","red");
			  		}
			  	}
			  }

			  if(board[board_x][board_y]["number"]>0){
			  	$(this).text(board[board_x][board_y]["number"]);
			  	$(this).css("color","red");
			  }
	});
}); 
	</script>
	<body>
	<p id="result">Click a square</p>
	<div id="board">
                <table class="grid">
                </table>
     </div>	
	</body>
</html>
